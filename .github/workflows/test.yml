name: test
on: 
  push: 
    branches: [ main ]
    paths: 
           - 'force-app/**'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Dependencies
        run: npm install sfdx-cli    
      - name: Populate Auth File
        run: 'echo "${{ secrets.SALESFORCE_AUTH_URL }}" > .SALESFORCE_AUTH_URL.txt'
      - name: Authenticate Dev Hub
        run: 'node_modules/sfdx-cli/bin/run force:auth:sfdxurl:store -f .SALESFORCE_AUTH_URL.txt -a devhub -d'
      - name: Set Default Username
        run: node_modules/sfdx-cli/bin/run config:set defaultusername=devhub
      - name: Run Tests
        run: node_modules/sfdx-cli/bin/run force:apex:test:run --resultformat tap --codecoverage -c -r human
